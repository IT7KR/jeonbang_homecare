# SMS ë³µìˆ˜ ë°œì†¡ ê¸°ëŠ¥ êµ¬í˜„ ê³„íšì„œ

> ì‘ì„±ì¼: 2025-12-02
> ìµœì¢… ì—…ë°ì´íŠ¸: 2025-12-27
> **ìƒíƒœ: í–¥í›„ êµ¬í˜„ ì˜ˆì • (ë¯¸êµ¬í˜„)**
>
> ì´ ë¬¸ì„œëŠ” í–¥í›„ êµ¬í˜„í•  SMS ë³µìˆ˜ ë°œì†¡ ê¸°ëŠ¥ì— ëŒ€í•œ ìƒì„¸ ê³„íšì„œì…ë‹ˆë‹¤.
> í˜„ì¬ëŠ” ë‹¨ì¼ SMS ë°œì†¡ ê¸°ëŠ¥ë§Œ ì§€ì›ë©ë‹ˆë‹¤.

---

## 1. ê°œìš”

### 1.1 ë°°ê²½

ê´€ë¦¬ìë¡œë¶€í„° "ë³µìˆ˜ì˜ ì¸ì›(ê³ ê°, í˜‘ë ¥ì‚¬)ì—ê²Œ ë¬¸ì ë°œì†¡ì´ ê°€ëŠ¥í•œì§€" ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ì‹œìŠ¤í…œì€ **ë‹¨ì¼ ìˆ˜ì‹ ì ê¸°ë°˜**ìœ¼ë¡œë§Œ SMS ë°œì†¡ì´ ê°€ëŠ¥í•˜ì—¬, ê³µì§€ì‚¬í•­ì´ë‚˜ ì¼ê´„ ì•ˆë‚´ ë°œì†¡ì´ ë¶ˆê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤.

### 1.2 ìš”êµ¬ì‚¬í•­

| êµ¬ë¶„ | ìš”êµ¬ì‚¬í•­ |
|------|----------|
| ë°œì†¡ ì‹œë‚˜ë¦¬ì˜¤ | ê³µì§€/ì•ˆë‚´ ë°œì†¡, ìƒíƒœë³„ ì¼ê´„ ë°œì†¡, ì„ íƒ ë°œì†¡ |
| ë°œì†¡ ëŒ€ìƒ | ê³ ê°(ì‹ ì²­ì) + í˜‘ë ¥ì‚¬ ëª¨ë‘ |
| ë°œì†¡ ê·œëª¨ | 50ëª… ì´ìƒ ëŒ€ê·œëª¨ ë°œì†¡ |
| êµ¬í˜„ ë°©ì‹ | ë¹„ë™ê¸° Job ê¸°ë°˜ (ì•ˆì •ì„± ìš°ì„ ) |
| UI ì ‘ê·¼ì  | SMS í˜ì´ì§€ + ì‹ ì²­/í˜‘ë ¥ì‚¬ ëª©ë¡ í˜ì´ì§€ í†µí•© |

### 1.3 ê²°ì •ëœ êµ¬í˜„ ë°©í–¥

- **ë¹„ë™ê¸° Job ë°©ì‹**: ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ë¡œ íƒ€ì„ì•„ì›ƒ ë°©ì§€, ì§„í–‰ ìƒí™© ì¶”ì  ê°€ëŠ¥
- **ê¸°ì¡´ í˜ì´ì§€ í†µí•©**: SMS í˜ì´ì§€ë¿ ì•„ë‹ˆë¼ ì‹ ì²­/í˜‘ë ¥ì‚¬ ëª©ë¡ì—ì„œë„ ì„ íƒ í›„ ë°œì†¡ ê°€ëŠ¥

---

## 2. í˜„ì¬ ìƒíƒœ ë¶„ì„

### 2.1 í˜„ì¬ SMS ë°œì†¡ ê¸°ëŠ¥ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     í˜„ì¬ SMS ë°œì†¡ íë¦„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [ê´€ë¦¬ì]                                                       â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ SMS ê´€ë¦¬ í˜ì´ì§€     â”‚                                        â”‚
â”‚  â”‚ (admin/sms/page.tsx)â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚     â”‚                                                           â”‚
â”‚     â”‚ ë‹¨ì¼ ë²ˆí˜¸ ì…ë ¥ + ë©”ì‹œì§€                                   â”‚
â”‚     â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ POST /admin/sms/sendâ”‚â”€â”€â”€â–¶â”‚ send_sms_direct()   â”‚             â”‚
â”‚  â”‚ (ë‹¨ì¼ ìˆ˜ì‹ ì)       â”‚    â”‚ (sms.py)            â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                            â”‚
â”‚                                    â–¼                            â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                             â”‚ Aligo API       â”‚                 â”‚
â”‚                             â”‚ (ë‹¨ì¼ ë°œì†¡)     â”‚                 â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                    â”‚                            â”‚
â”‚                                    â–¼                            â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                             â”‚ SMSLog ê¸°ë¡     â”‚                 â”‚
â”‚                             â”‚ (1ê±´)           â”‚                 â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 í˜„ì¬ ê´€ë ¨ íŒŒì¼ ìƒì„¸

#### Backend íŒŒì¼

| íŒŒì¼ ê²½ë¡œ | ì—­í•  | í˜„ì¬ ìƒíƒœ |
|-----------|------|-----------|
| `backend/app/models/sms_log.py` | SMS ë°œì†¡ ë¡œê·¸ ëª¨ë¸ | ë‹¨ì¼ ë°œì†¡ ë¡œê·¸ë§Œ ê¸°ë¡ |
| `backend/app/services/sms.py` | SMS ë°œì†¡ ì„œë¹„ìŠ¤ | `send_sms_direct()` ë‹¨ì¼ ë°œì†¡ë§Œ |
| `backend/app/api/v1/endpoints/admin/sms.py` | SMS API ì—”ë“œí¬ì¸íŠ¸ | `/send` ë‹¨ì¼ ë°œì†¡ë§Œ |
| `backend/app/schemas/sms_log.py` | SMS ìŠ¤í‚¤ë§ˆ | ë‹¨ì¼ ìˆ˜ì‹ ì ìš”ì²­ë§Œ |

#### Frontend íŒŒì¼

| íŒŒì¼ ê²½ë¡œ | ì—­í•  | í˜„ì¬ ìƒíƒœ |
|-----------|------|-----------|
| `frontend/src/app/(admin)/admin/sms/page.tsx` | SMS ê´€ë¦¬ í˜ì´ì§€ | ë‹¨ì¼ ë°œì†¡ ëª¨ë‹¬ë§Œ |
| `frontend/src/lib/api/admin/sms.ts` | SMS API í•¨ìˆ˜ | `sendSMS()` ë‹¨ì¼ ë°œì†¡ë§Œ |
| `frontend/src/lib/api/admin/types.ts` | API íƒ€ì… ì •ì˜ | ë‹¨ì¼ ë°œì†¡ íƒ€ì…ë§Œ |

### 2.3 í˜„ì¬ ì½”ë“œ ìƒì„¸ ë¶„ì„

#### 2.3.1 SMSLog ëª¨ë¸ (`backend/app/models/sms_log.py`)

```python
class SMSLog(Base):
    __tablename__ = "sms_logs"

    id = Column(BigInteger, primary_key=True, autoincrement=True)

    # ë°œì†¡ ì •ë³´
    receiver_phone = Column(String(500), nullable=False)  # ìˆ˜ì‹ ì (ì•”í˜¸í™”)
    message = Column(Text, nullable=False)

    # ë°œì†¡ ìœ í˜•
    sms_type = Column(String(50), nullable=False)  # application_new, partner_new, manual ë“±

    # ê´€ë ¨ ë°ì´í„° ì°¸ì¡°
    reference_type = Column(String(50), nullable=True)  # application, partner
    reference_id = Column(BigInteger, nullable=True)

    # ë°œì†¡ ìƒíƒœ
    status = Column(String(20), nullable=False, default="pending", index=True)

    # ì•Œë¦¬ê³  API ì‘ë‹µ
    result_code = Column(String(20), nullable=True)
    result_message = Column(String(500), nullable=True)
    msg_id = Column(String(100), nullable=True)

    # íƒ€ì„ìŠ¤íƒ¬í”„
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    sent_at = Column(DateTime(timezone=True), nullable=True)
```

**ë¶„ì„**:
- ê°œë³„ SMS ë°œì†¡ ë¡œê·¸ ê¸°ë¡ìš©
- ë³µìˆ˜ ë°œì†¡ ì‹œ Job ì°¸ì¡° í•„ë“œ ì—†ìŒ
- ë°°ì¹˜ ì •ë³´ ì—†ìŒ

#### 2.3.2 SMS ë°œì†¡ ì„œë¹„ìŠ¤ (`backend/app/services/sms.py`)

```python
async def send_sms_direct(
    receiver: str,                    # ë‹¨ì¼ ìˆ˜ì‹ ìë§Œ
    message: str,
    sms_type: str = "manual",
    reference_type: Optional[str] = None,
    reference_id: Optional[int] = None,
    db: Optional[Session] = None,
) -> dict:
    """SMS ë°œì†¡ + DB ë¡œê·¸ ê¸°ë¡"""
    # 1. Aligo API í˜¸ì¶œ (ë‹¨ì¼)
    # 2. SMSLog ìƒì„± (1ê±´)
    # 3. ê²°ê³¼ ë°˜í™˜
```

**ë¶„ì„**:
- `receiver: str` - ë‹¨ì¼ ìˆ˜ì‹ ìë§Œ ì²˜ë¦¬
- ë£¨í”„ ì²˜ë¦¬ ë¡œì§ ì—†ìŒ
- ë°°ì¹˜ ì²˜ë¦¬ ë¯¸ì§€ì›

#### 2.3.3 SMS API ì—”ë“œí¬ì¸íŠ¸ (`backend/app/api/v1/endpoints/admin/sms.py`)

```python
@router.post("/send", response_model=SMSSendResponse)
async def send_manual_sms(
    data: SMSSendRequest,  # receiver_phone: str (ë‹¨ì¼)
    db: Session = Depends(get_db),
    current_admin: Admin = Depends(get_current_admin),
):
    result = await send_sms_direct(
        receiver=data.receiver_phone,  # ë‹¨ì¼ê°’
        message=data.message,
        sms_type=data.sms_type,
        db=db,
    )
```

**ë¶„ì„**:
- ë‹¨ì¼ ë°œì†¡ ì—”ë“œí¬ì¸íŠ¸ë§Œ ì¡´ì¬
- ë³µìˆ˜ ë°œì†¡ ì—”ë“œí¬ì¸íŠ¸ ì—†ìŒ
- ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ API ì—†ìŒ

#### 2.3.4 Frontend SMS í˜ì´ì§€ (`frontend/src/app/(admin)/admin/sms/page.tsx`)

```typescript
// ë°œì†¡ ëª¨ë‹¬ - ë‹¨ì¼ ë²ˆí˜¸ ì…ë ¥ë§Œ
<input
  type="tel"
  value={sendPhone}  // ë‹¨ì¼ ë²ˆí˜¸
  placeholder="010-1234-5678"
/>

// ë°œì†¡ í•¨ìˆ˜
const handleSendSMS = async (e: React.FormEvent) => {
  const result = await sendSMS(token, {
    receiver_phone: sendPhone,  // ë‹¨ì¼
    message: sendMessage,
    sms_type: "manual",
  });
};
```

**ë¶„ì„**:
- ë‹¨ì¼ ë²ˆí˜¸ ì…ë ¥ í•„ë“œë§Œ ì¡´ì¬
- ìˆ˜ì‹ ì ì„ íƒ UI ì—†ìŒ
- ë³µìˆ˜ ë°œì†¡ ë²„íŠ¼ ì—†ìŒ

### 2.4 í˜„ì¬ ê¸°ëŠ¥ ìš”ì•½ í…Œì´ë¸”

| ê¸°ëŠ¥ | í˜„ì¬ ìƒíƒœ | ë¹„ê³  |
|------|-----------|------|
| ë‹¨ì¼ ìˆ˜ë™ ë°œì†¡ | âœ… ì§€ì› | ê´€ë¦¬ìê°€ ë²ˆí˜¸ ì§ì ‘ ì…ë ¥ |
| ìë™ ì•Œë¦¼ ë°œì†¡ | âœ… ì§€ì› | ì‹ ì²­/í˜‘ë ¥ì‚¬ ë“±ë¡ ì‹œ ìë™ ë°œì†¡ |
| ë°œì†¡ ë‚´ì—­ ì¡°íšŒ | âœ… ì§€ì› | í˜ì´ì§€ë„¤ì´ì…˜, í•„í„°ë§ |
| ì‹¤íŒ¨ ê±´ ì¬ë°œì†¡ | âœ… ì§€ì› | ê°œë³„ ì¬ë°œì†¡ |
| **ë³µìˆ˜ ìˆ˜ë™ ë°œì†¡** | âŒ ë¯¸ì§€ì› | êµ¬í˜„ í•„ìš” |
| **ìˆ˜ì‹ ì ëª©ë¡ ì„ íƒ** | âŒ ë¯¸ì§€ì› | êµ¬í˜„ í•„ìš” |
| **ë°œì†¡ ì§„í–‰ ìƒí™© í‘œì‹œ** | âŒ ë¯¸ì§€ì› | êµ¬í˜„ í•„ìš” |

---

## 3. êµ¬í˜„ ê³„íš ìƒì„¸

### 3.1 ì „ì²´ ì•„í‚¤í…ì²˜ (ëª©í‘œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SMS ë³µìˆ˜ ë°œì†¡ ì•„í‚¤í…ì²˜ (ëª©í‘œ)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ SMS ê´€ë¦¬ í˜ì´ì§€ â”‚  â”‚ ì‹ ì²­ ê´€ë¦¬ í˜ì´ì§€â”‚  â”‚ í˜‘ë ¥ì‚¬ ê´€ë¦¬    â”‚              â”‚
â”‚  â”‚ [ë³µìˆ˜ ë°œì†¡]     â”‚  â”‚ [ì²´í¬ë°•ìŠ¤ ì„ íƒ] â”‚  â”‚ [ì²´í¬ë°•ìŠ¤ ì„ íƒ]â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚           â”‚                    â”‚                    â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚ BulkSMSSheet          â”‚                                â”‚
â”‚                    â”‚ (ìˆ˜ì‹ ì ì„ íƒ + ë©”ì‹œì§€) â”‚                                â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚ POST /admin/sms/bulk  â”‚                                â”‚
â”‚                    â”‚ (Job ìƒì„± ìš”ì²­)       â”‚                                â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â–¼                      â–¼                      â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ì¦‰ì‹œ ì‘ë‹µ   â”‚     â”‚ BulkSMSJob      â”‚     â”‚ BackgroundTask   â”‚           â”‚
â”‚  â”‚ (job_id)    â”‚     â”‚ ìƒì„± ë° ì €ì¥    â”‚     â”‚ ì‹œì‘             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                       â”‚                     â”‚
â”‚                                                       â–¼                     â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                                            â”‚ BulkSMSService      â”‚          â”‚
â”‚                                            â”‚ execute_bulk_send() â”‚          â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚                       â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                      â–¼                              â–¼               â–¼       â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚               â”‚ Batch 1    â”‚              â”‚ Batch 2    â”‚    â”‚ Batch N    â”‚  â”‚
â”‚               â”‚ (50ëª…)     â”‚              â”‚ (50ëª…)     â”‚    â”‚ (ë‚˜ë¨¸ì§€)   â”‚  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚                           â”‚                 â”‚         â”‚
â”‚                     â–¼                           â–¼                 â–¼         â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚               â”‚ ë³‘ë ¬ ë°œì†¡  â”‚              â”‚ ë³‘ë ¬ ë°œì†¡  â”‚    â”‚ ë³‘ë ¬ ë°œì†¡  â”‚  â”‚
â”‚               â”‚ + ë¡œê·¸ê¸°ë¡ â”‚              â”‚ + ë¡œê·¸ê¸°ë¡ â”‚    â”‚ + ë¡œê·¸ê¸°ë¡ â”‚  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚                           â”‚                 â”‚         â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                        â”‚                                    â”‚
â”‚                                        â–¼                                    â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                              â”‚ Job ìƒíƒœ ì—…ë°ì´íŠ¸   â”‚                        â”‚
â”‚                              â”‚ (completed/failed)  â”‚                        â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                        â”‚                                    â”‚
â”‚                                        â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚                    Frontend (í´ë§)                               â”‚        â”‚
â”‚  â”‚  GET /admin/sms/bulk/{job_id} â†’ ì§„í–‰ ìƒí™© í‘œì‹œ â†’ ì™„ë£Œ ì•Œë¦¼      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½

#### 3.2.1 ì‹ ê·œ í…Œì´ë¸”: `bulk_sms_jobs`

```sql
CREATE TABLE bulk_sms_jobs (
    id BIGSERIAL PRIMARY KEY,

    -- Job ì •ë³´
    job_type VARCHAR(50) NOT NULL,      -- 'announcement', 'status_notify', 'manual_select'
    title VARCHAR(200),                  -- Job ì œëª© (ê´€ë¦¬ì ì‹ë³„ìš©)

    -- ë°œì†¡ ëŒ€ìƒ ì„¤ì •
    target_type VARCHAR(20) NOT NULL,   -- 'customer', 'partner', 'all'
    target_filter JSONB,                 -- {"status": "new", "region": "ì–‘í‰êµ°"}
    target_ids JSONB,                    -- ì„ íƒ ë°œì†¡ ì‹œ ID ëª©ë¡ [1, 2, 3]

    -- ë©”ì‹œì§€
    message TEXT NOT NULL,

    -- í†µê³„
    total_count INTEGER DEFAULT 0,       -- ì „ì²´ ìˆ˜ì‹ ì ìˆ˜
    sent_count INTEGER DEFAULT 0,        -- ë°œì†¡ ì™„ë£Œ
    failed_count INTEGER DEFAULT 0,      -- ë°œì†¡ ì‹¤íŒ¨

    -- ìƒíƒœ
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    -- 'pending': ëŒ€ê¸°
    -- 'processing': ì²˜ë¦¬ ì¤‘
    -- 'completed': ì™„ë£Œ
    -- 'partial_failed': ë¶€ë¶„ ì‹¤íŒ¨
    -- 'failed': ì „ì²´ ì‹¤íŒ¨
    -- 'cancelled': ì·¨ì†Œ

    -- ì§„í–‰ ì •ë³´
    current_batch INTEGER DEFAULT 0,
    total_batches INTEGER DEFAULT 0,

    -- ì—ëŸ¬ ì •ë³´
    error_message TEXT,
    failed_recipients JSONB,             -- [{"phone": "5678", "error": "..."}]

    -- ê´€ë¦¬ì
    created_by BIGINT NOT NULL,          -- Admin.id

    -- íƒ€ì„ìŠ¤íƒ¬í”„
    created_at TIMESTAMPTZ DEFAULT NOW(),
    started_at TIMESTAMPTZ,
    completed_at TIMESTAMPTZ
);

CREATE INDEX idx_bulk_sms_jobs_status ON bulk_sms_jobs(status);
CREATE INDEX idx_bulk_sms_jobs_created_by ON bulk_sms_jobs(created_by);
CREATE INDEX idx_bulk_sms_jobs_created_at ON bulk_sms_jobs(created_at DESC);
```

#### 3.2.2 ê¸°ì¡´ í…Œì´ë¸” ìˆ˜ì •: `sms_logs`

```sql
-- ìƒˆ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE sms_logs ADD COLUMN bulk_job_id BIGINT;
ALTER TABLE sms_logs ADD COLUMN batch_index INTEGER;

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_sms_logs_bulk_job_id ON sms_logs(bulk_job_id);
```

---

## 4. Backend êµ¬í˜„ ìƒì„¸

### 4.1 íŒŒì¼ë³„ êµ¬í˜„ ë‚´ìš©

#### 4.1.1 ì‹ ê·œ íŒŒì¼: `backend/app/models/bulk_sms_job.py`

```python
"""
Bulk SMS Job ëª¨ë¸
ëŒ€ëŸ‰ SMS ë°œì†¡ ì‘ì—… ê´€ë¦¬

PK: BIGSERIAL as per CLAUDE.md
ìƒíƒœ: pending â†’ processing â†’ completed / partial_failed / failed
"""

from sqlalchemy import Column, BigInteger, String, Text, Integer, DateTime
from sqlalchemy.dialects.postgresql import JSONB
from sqlalchemy.sql import func

from app.core.database import Base


class BulkSMSJob(Base):
    """ëŒ€ëŸ‰ SMS ë°œì†¡ ì‘ì—…"""

    __tablename__ = "bulk_sms_jobs"

    id = Column(BigInteger, primary_key=True, autoincrement=True)

    # Job ì •ë³´
    job_type = Column(String(50), nullable=False)  # announcement, status_notify, manual_select
    title = Column(String(200), nullable=True)

    # ë°œì†¡ ëŒ€ìƒ ì„¤ì •
    target_type = Column(String(20), nullable=False)  # customer, partner, all
    target_filter = Column(JSONB, nullable=True)  # {"status": "new", "region": "ì–‘í‰êµ°"}
    target_ids = Column(JSONB, nullable=True)  # ì„ íƒ ë°œì†¡ ì‹œ ID ëª©ë¡

    # ë©”ì‹œì§€
    message = Column(Text, nullable=False)

    # í†µê³„
    total_count = Column(Integer, default=0)
    sent_count = Column(Integer, default=0)
    failed_count = Column(Integer, default=0)

    # ìƒíƒœ
    status = Column(String(20), nullable=False, default="pending", index=True)

    # ì§„í–‰ ì •ë³´
    current_batch = Column(Integer, default=0)
    total_batches = Column(Integer, default=0)

    # ì—ëŸ¬ ì •ë³´
    error_message = Column(Text, nullable=True)
    failed_recipients = Column(JSONB, nullable=True)

    # ê´€ë¦¬ì
    created_by = Column(BigInteger, nullable=False)

    # íƒ€ì„ìŠ¤íƒ¬í”„
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    started_at = Column(DateTime(timezone=True), nullable=True)
    completed_at = Column(DateTime(timezone=True), nullable=True)

    def __repr__(self):
        return f"<BulkSMSJob {self.id}: {self.job_type} - {self.status}>"
```

#### 4.1.2 ìˆ˜ì • íŒŒì¼: `backend/app/models/sms_log.py`

**ì¶”ê°€í•  í•„ë“œ:**

```python
# ë³µìˆ˜ ë°œì†¡ ì°¸ì¡° (ê¸°ì¡´ í•„ë“œ ì•„ë˜ì— ì¶”ê°€)
bulk_job_id = Column(BigInteger, nullable=True, index=True)  # BulkSMSJob.id
batch_index = Column(Integer, nullable=True)  # ë°°ì¹˜ ë²ˆí˜¸
```

#### 4.1.3 ìˆ˜ì • íŒŒì¼: `backend/app/models/__init__.py`

**ì¶”ê°€í•  import:**

```python
from app.models.bulk_sms_job import BulkSMSJob

__all__ = [
    # ... ê¸°ì¡´ í•­ëª©
    "BulkSMSJob",
]
```

#### 4.1.4 ì‹ ê·œ íŒŒì¼: `backend/app/schemas/bulk_sms.py`

```python
"""
Bulk SMS ìŠ¤í‚¤ë§ˆ
ëŒ€ëŸ‰ SMS ë°œì†¡ ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
"""

from datetime import datetime
from typing import Optional
from pydantic import BaseModel, field_validator
import re


class BulkSMSSendRequest(BaseModel):
    """ëŒ€ëŸ‰ SMS ë°œì†¡ ìš”ì²­"""

    job_type: str  # announcement, status_notify, manual_select
    title: Optional[str] = None
    target_type: str  # customer, partner
    target_filter: Optional[dict] = None  # {"status": "new"}
    target_ids: Optional[list[int]] = None  # [1, 2, 3]
    message: str

    @field_validator("job_type")
    @classmethod
    def validate_job_type(cls, v: str) -> str:
        allowed = ["announcement", "status_notify", "manual_select"]
        if v not in allowed:
            raise ValueError(f"job_typeì€ {allowed} ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤")
        return v

    @field_validator("target_type")
    @classmethod
    def validate_target_type(cls, v: str) -> str:
        allowed = ["customer", "partner"]
        if v not in allowed:
            raise ValueError(f"target_typeì€ {allowed} ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤")
        return v

    @field_validator("message")
    @classmethod
    def validate_message(cls, v: str) -> str:
        if not v or len(v.strip()) == 0:
            raise ValueError("ë©”ì‹œì§€ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤")
        if len(v) > 2000:
            raise ValueError("ë©”ì‹œì§€ëŠ” 2000ì ì´ë‚´ì—¬ì•¼ í•©ë‹ˆë‹¤")
        return v


class BulkSMSJobResponse(BaseModel):
    """ëŒ€ëŸ‰ SMS Job ìƒì„± ì‘ë‹µ"""

    job_id: int
    status: str
    message: str


class BulkSMSJobDetailResponse(BaseModel):
    """ëŒ€ëŸ‰ SMS Job ìƒì„¸ ì‘ë‹µ"""

    id: int
    job_type: str
    title: Optional[str]
    target_type: str
    status: str
    total_count: int
    sent_count: int
    failed_count: int
    progress: float  # 0-100%
    current_batch: int
    total_batches: int
    failed_recipients: Optional[list]
    created_at: datetime
    started_at: Optional[datetime]
    completed_at: Optional[datetime]

    class Config:
        from_attributes = True


class BulkSMSJobListResponse(BaseModel):
    """ëŒ€ëŸ‰ SMS Job ëª©ë¡ ì‘ë‹µ"""

    items: list[BulkSMSJobDetailResponse]
    total: int
    page: int
    page_size: int


class SMSRecipient(BaseModel):
    """SMS ìˆ˜ì‹ ì"""

    id: int
    name: str
    phone: str  # ë§ˆìŠ¤í‚¹ëœ ë²ˆí˜¸ (010-****-5678)
    label: str  # ì‹ ì²­ë²ˆí˜¸ ë˜ëŠ” íšŒì‚¬ëª…
    type: str  # customer, partner


class SMSRecipientsResponse(BaseModel):
    """SMS ìˆ˜ì‹ ì ëª©ë¡ ì‘ë‹µ"""

    items: list[SMSRecipient]
    total: int
    page: int
    page_size: int
```

#### 4.1.5 ì‹ ê·œ íŒŒì¼: `backend/app/services/bulk_sms.py`

```python
"""
Bulk SMS Service
ëŒ€ëŸ‰ SMS ë°œì†¡ ì„œë¹„ìŠ¤

í•µì‹¬ ê¸°ëŠ¥:
- ë°°ì¹˜ ë¶„í•  (50ëª… ë‹¨ìœ„)
- ë¹„ë™ê¸° ë³‘ë ¬ ë°œì†¡
- ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„
- ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
"""

import asyncio
import math
from datetime import datetime, timezone
from typing import Optional

from sqlalchemy.orm import Session

from app.models.bulk_sms_job import BulkSMSJob
from app.models.application import Application
from app.models.partner import Partner
from app.services.sms import send_sms_direct
from app.core.security import decrypt_value

# ì„¤ì •
BATCH_SIZE = 50  # ë°°ì¹˜ë‹¹ ìˆ˜ì‹ ì ìˆ˜
RETRY_ATTEMPTS = 3  # ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
RETRY_DELAY_BASE = 1.0  # ì¬ì‹œë„ ê¸°ë³¸ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)
BATCH_DELAY = 0.5  # ë°°ì¹˜ ê°„ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)


class BulkSMSService:
    """ëŒ€ëŸ‰ SMS ë°œì†¡ ì„œë¹„ìŠ¤"""

    def __init__(self, db: Session):
        self.db = db

    async def execute_bulk_send(self, job_id: int):
        """
        ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ - BackgroundTaskì—ì„œ í˜¸ì¶œ

        1. Job ì‹œì‘ ìƒíƒœ ì—…ë°ì´íŠ¸
        2. ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ
        3. ë°°ì¹˜ ë¶„í•  ì²˜ë¦¬
        4. ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
        """
        job = self.db.query(BulkSMSJob).filter(BulkSMSJob.id == job_id).first()
        if not job:
            return

        try:
            # Job ì‹œì‘
            job.status = "processing"
            job.started_at = datetime.now(timezone.utc)
            self.db.commit()

            # ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ
            recipients = self._get_recipients(job)
            job.total_count = len(recipients)
            job.total_batches = math.ceil(len(recipients) / BATCH_SIZE)
            self.db.commit()

            if not recipients:
                job.status = "completed"
                job.completed_at = datetime.now(timezone.utc)
                self.db.commit()
                return

            # ë°°ì¹˜ ë¶„í•  ì²˜ë¦¬
            for batch_index, batch in enumerate(self._chunk(recipients, BATCH_SIZE)):
                await self._process_batch(job, batch, batch_index)
                job.current_batch = batch_index + 1
                self.db.commit()

                # ë°°ì¹˜ ê°„ ë”œë ˆì´
                if batch_index < job.total_batches - 1:
                    await asyncio.sleep(BATCH_DELAY)

            # ì™„ë£Œ ì²˜ë¦¬
            job.status = "completed" if job.failed_count == 0 else "partial_failed"
            job.completed_at = datetime.now(timezone.utc)
            self.db.commit()

        except Exception as e:
            job.status = "failed"
            job.error_message = str(e)
            job.completed_at = datetime.now(timezone.utc)
            self.db.commit()

    async def _process_batch(self, job: BulkSMSJob, recipients: list, batch_index: int):
        """ë‹¨ì¼ ë°°ì¹˜ ì²˜ë¦¬ (ë³‘ë ¬ ë°œì†¡)"""
        tasks = []
        for recipient in recipients:
            task = self._send_with_retry(job, recipient, batch_index)
            tasks.append(task)

        # ë°°ì¹˜ ë‚´ ë³‘ë ¬ ì‹¤í–‰
        results = await asyncio.gather(*tasks, return_exceptions=True)

        # ê²°ê³¼ ì²˜ë¦¬
        for recipient, result in zip(recipients, results):
            if isinstance(result, Exception) or not result.get("success"):
                job.failed_count += 1
                if job.failed_recipients is None:
                    job.failed_recipients = []
                job.failed_recipients.append({
                    "phone": recipient["phone"][-4:],  # ë§ˆì§€ë§‰ 4ìë¦¬ë§Œ
                    "name": recipient.get("name", ""),
                    "error": str(result) if isinstance(result, Exception) else result.get("error", "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜")
                })
            else:
                job.sent_count += 1

    async def _send_with_retry(self, job: BulkSMSJob, recipient: dict, batch_index: int) -> dict:
        """ì¬ì‹œë„ ë¡œì§ì´ í¬í•¨ëœ ë‹¨ì¼ SMS ë°œì†¡"""
        for attempt in range(RETRY_ATTEMPTS):
            try:
                result = await send_sms_direct(
                    receiver=recipient["phone"],
                    message=job.message,
                    sms_type=f"bulk_{job.job_type}",
                    reference_type="bulk_job",
                    reference_id=job.id,
                    db=self.db,
                    bulk_job_id=job.id,
                    batch_index=batch_index,
                )
                return result

            except Exception as e:
                if attempt < RETRY_ATTEMPTS - 1:
                    delay = RETRY_DELAY_BASE * (2 ** attempt)  # ì§€ìˆ˜ ë°±ì˜¤í”„
                    await asyncio.sleep(delay)
                else:
                    return {"success": False, "error": str(e)}

        return {"success": False, "error": "ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼"}

    def _get_recipients(self, job: BulkSMSJob) -> list:
        """Job ì„¤ì •ì— ë”°ë¼ ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ"""
        recipients = []

        if job.target_type == "customer":
            recipients = self._query_customers(job)
        elif job.target_type == "partner":
            recipients = self._query_partners(job)

        return recipients

    def _query_customers(self, job: BulkSMSJob) -> list:
        """ê³ ê°(ì‹ ì²­ì) ëª©ë¡ ì¡°íšŒ"""
        query = self.db.query(Application)

        # ì„ íƒ ë°œì†¡
        if job.target_ids:
            query = query.filter(Application.id.in_(job.target_ids))

        # í•„í„° ì ìš©
        if job.target_filter:
            if "status" in job.target_filter:
                query = query.filter(Application.status == job.target_filter["status"])
            # ì¶”ê°€ í•„í„° ì¡°ê±´...

        recipients = []
        for app in query.all():
            try:
                phone = decrypt_value(app.customer_phone)
                name = decrypt_value(app.customer_name)
                recipients.append({
                    "type": "customer",
                    "id": app.id,
                    "phone": phone,
                    "name": name,
                    "label": app.application_number,
                })
            except Exception:
                continue

        return recipients

    def _query_partners(self, job: BulkSMSJob) -> list:
        """í˜‘ë ¥ì‚¬ ëª©ë¡ ì¡°íšŒ"""
        query = self.db.query(Partner)

        # ì„ íƒ ë°œì†¡
        if job.target_ids:
            query = query.filter(Partner.id.in_(job.target_ids))

        # í•„í„° ì ìš©
        if job.target_filter:
            if "status" in job.target_filter:
                query = query.filter(Partner.status == job.target_filter["status"])

        recipients = []
        for partner in query.all():
            try:
                phone = decrypt_value(partner.contact_phone)
                recipients.append({
                    "type": "partner",
                    "id": partner.id,
                    "phone": phone,
                    "name": partner.company_name,
                    "label": partner.company_name,
                })
            except Exception:
                continue

        return recipients

    def _chunk(self, lst: list, size: int):
        """ë¦¬ìŠ¤íŠ¸ë¥¼ ì§€ì • í¬ê¸°ë¡œ ë¶„í• """
        for i in range(0, len(lst), size):
            yield lst[i:i + size]
```

#### 4.1.6 ìˆ˜ì • íŒŒì¼: `backend/app/services/sms.py`

**`send_sms_direct()` í•¨ìˆ˜ ìˆ˜ì •:**

```python
async def send_sms_direct(
    receiver: str,
    message: str,
    sms_type: str = "manual",
    reference_type: Optional[str] = None,
    reference_id: Optional[int] = None,
    db: Optional[Session] = None,
    bulk_job_id: Optional[int] = None,    # ì¶”ê°€
    batch_index: Optional[int] = None,    # ì¶”ê°€
) -> dict:
    """SMS ë°œì†¡ + DB ë¡œê·¸ ê¸°ë¡"""

    # ... ê¸°ì¡´ ë°œì†¡ ë¡œì§ ...

    # SMSLog ìƒì„± ì‹œ bulk í•„ë“œ ì¶”ê°€
    if db:
        log = SMSLog(
            receiver_phone=encrypt_value(receiver),
            message=message,
            sms_type=sms_type,
            reference_type=reference_type,
            reference_id=reference_id,
            bulk_job_id=bulk_job_id,       # ì¶”ê°€
            batch_index=batch_index,        # ì¶”ê°€
            status=status,
            result_code=result_code,
            result_message=result_message,
            msg_id=msg_id,
            sent_at=datetime.now(timezone.utc) if success else None,
        )
        db.add(log)
        db.commit()
```

#### 4.1.7 ìˆ˜ì • íŒŒì¼: `backend/app/api/v1/endpoints/admin/sms.py`

**ì¶”ê°€í•  ì—”ë“œí¬ì¸íŠ¸:**

```python
from fastapi import BackgroundTasks
from app.models.bulk_sms_job import BulkSMSJob
from app.schemas.bulk_sms import (
    BulkSMSSendRequest,
    BulkSMSJobResponse,
    BulkSMSJobDetailResponse,
    BulkSMSJobListResponse,
    SMSRecipient,
    SMSRecipientsResponse,
)
from app.services.bulk_sms import BulkSMSService
from app.services.background import run_async_in_background


# ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ (ì„ íƒ ë°œì†¡ìš©)
@router.get("/recipients", response_model=SMSRecipientsResponse)
def get_sms_recipients(
    target_type: str = Query(..., description="ëŒ€ìƒ ìœ í˜•: application | partner"),
    status: Optional[str] = Query(None, description="ìƒíƒœ í•„í„°"),
    search: Optional[str] = Query(None, description="ê²€ìƒ‰ì–´"),
    page: int = Query(1, ge=1),
    page_size: int = Query(50, ge=1, le=100),
    db: Session = Depends(get_db),
    current_admin: Admin = Depends(get_current_admin),
):
    """SMS ë°œì†¡ ëŒ€ìƒ ëª©ë¡ ì¡°íšŒ"""
    recipients = []

    if target_type == "application":
        query = db.query(Application)
        if status:
            query = query.filter(Application.status == status)
        # search í•„í„° ì¶”ê°€...

        total = query.count()
        items = query.offset((page - 1) * page_size).limit(page_size).all()

        for app in items:
            try:
                phone = decrypt_value(app.customer_phone)
                name = decrypt_value(app.customer_name)
                recipients.append(SMSRecipient(
                    id=app.id,
                    name=name,
                    phone=mask_phone(phone),  # 010-****-5678
                    label=app.application_number,
                    type="customer",
                ))
            except Exception:
                continue

    elif target_type == "partner":
        query = db.query(Partner)
        if status:
            query = query.filter(Partner.status == status)

        total = query.count()
        items = query.offset((page - 1) * page_size).limit(page_size).all()

        for partner in items:
            try:
                phone = decrypt_value(partner.contact_phone)
                recipients.append(SMSRecipient(
                    id=partner.id,
                    name=partner.company_name,
                    phone=mask_phone(phone),
                    label=partner.company_name,
                    type="partner",
                ))
            except Exception:
                continue

    return SMSRecipientsResponse(
        items=recipients,
        total=total,
        page=page,
        page_size=page_size,
    )


# ë³µìˆ˜ ë°œì†¡ Job ìƒì„±
@router.post("/bulk", response_model=BulkSMSJobResponse)
async def create_bulk_sms(
    data: BulkSMSSendRequest,
    background_tasks: BackgroundTasks,
    db: Session = Depends(get_db),
    current_admin: Admin = Depends(get_current_admin),
):
    """ëŒ€ëŸ‰ SMS ë°œì†¡ Job ìƒì„± (ë¹„ë™ê¸°)"""

    # Job ìƒì„±
    job = BulkSMSJob(
        job_type=data.job_type,
        title=data.title,
        target_type=data.target_type,
        target_filter=data.target_filter,
        target_ids=data.target_ids,
        message=data.message,
        created_by=current_admin.id,
    )
    db.add(job)
    db.commit()
    db.refresh(job)

    # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
    service = BulkSMSService(db)
    background_tasks.add_task(
        run_async_in_background,
        service.execute_bulk_send(job.id)
    )

    return BulkSMSJobResponse(
        job_id=job.id,
        status="pending",
        message="ë°œì†¡ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”.",
    )


# Job ìƒíƒœ ì¡°íšŒ (í´ë§ìš©)
@router.get("/bulk/{job_id}", response_model=BulkSMSJobDetailResponse)
def get_bulk_sms_job(
    job_id: int,
    db: Session = Depends(get_db),
    current_admin: Admin = Depends(get_current_admin),
):
    """ëŒ€ëŸ‰ SMS ë°œì†¡ Job ìƒíƒœ ì¡°íšŒ"""
    job = db.query(BulkSMSJob).filter(BulkSMSJob.id == job_id).first()
    if not job:
        raise HTTPException(status_code=404, detail="Jobì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")

    progress = 0.0
    if job.total_count > 0:
        progress = round((job.sent_count + job.failed_count) / job.total_count * 100, 1)

    return BulkSMSJobDetailResponse(
        id=job.id,
        job_type=job.job_type,
        title=job.title,
        target_type=job.target_type,
        status=job.status,
        total_count=job.total_count,
        sent_count=job.sent_count,
        failed_count=job.failed_count,
        progress=progress,
        current_batch=job.current_batch,
        total_batches=job.total_batches,
        failed_recipients=job.failed_recipients,
        created_at=job.created_at,
        started_at=job.started_at,
        completed_at=job.completed_at,
    )


# Job ëª©ë¡ ì¡°íšŒ
@router.get("/bulk", response_model=BulkSMSJobListResponse)
def list_bulk_sms_jobs(
    page: int = Query(1, ge=1),
    page_size: int = Query(20, ge=1, le=100),
    db: Session = Depends(get_db),
    current_admin: Admin = Depends(get_current_admin),
):
    """ëŒ€ëŸ‰ SMS ë°œì†¡ Job ëª©ë¡ ì¡°íšŒ"""
    query = db.query(BulkSMSJob).order_by(BulkSMSJob.created_at.desc())

    total = query.count()
    items = query.offset((page - 1) * page_size).limit(page_size).all()

    return BulkSMSJobListResponse(
        items=[...],  # BulkSMSJobDetailResponse ë³€í™˜
        total=total,
        page=page,
        page_size=page_size,
    )


# í—¬í¼ í•¨ìˆ˜
def mask_phone(phone: str) -> str:
    """ì „í™”ë²ˆí˜¸ ë§ˆìŠ¤í‚¹ (010-****-5678)"""
    if len(phone) >= 8:
        return phone[:3] + "-****-" + phone[-4:]
    return phone
```

---

## 5. Frontend êµ¬í˜„ ìƒì„¸

### 5.1 íŒŒì¼ë³„ êµ¬í˜„ ë‚´ìš©

#### 5.1.1 ìˆ˜ì • íŒŒì¼: `frontend/src/lib/api/admin/types.ts`

**ì¶”ê°€í•  íƒ€ì…:**

```typescript
// ==================== Bulk SMS ====================

/** SMS ìˆ˜ì‹ ì */
export interface SMSRecipient {
  id: number;
  name: string;
  phone: string;  // ë§ˆìŠ¤í‚¹ëœ ë²ˆí˜¸
  label: string;
  type: "customer" | "partner";
}

/** SMS ìˆ˜ì‹ ì ëª©ë¡ ì‘ë‹µ */
export interface SMSRecipientsResponse {
  items: SMSRecipient[];
  total: number;
  page: number;
  page_size: number;
}

/** ëŒ€ëŸ‰ SMS ë°œì†¡ ìš”ì²­ */
export interface BulkSMSSendRequest {
  job_type: "announcement" | "status_notify" | "manual_select";
  title?: string;
  target_type: "customer" | "partner";
  target_filter?: Record<string, string>;
  target_ids?: number[];
  message: string;
}

/** ëŒ€ëŸ‰ SMS Job ìƒì„± ì‘ë‹µ */
export interface BulkSMSJobResponse {
  job_id: number;
  status: string;
  message: string;
}

/** ëŒ€ëŸ‰ SMS Job ìƒì„¸ */
export interface BulkSMSJobDetail {
  id: number;
  job_type: string;
  title?: string;
  target_type: string;
  status: "pending" | "processing" | "completed" | "partial_failed" | "failed" | "cancelled";
  total_count: number;
  sent_count: number;
  failed_count: number;
  progress: number;  // 0-100
  current_batch: number;
  total_batches: number;
  failed_recipients?: Array<{
    phone: string;
    name: string;
    error: string;
  }>;
  created_at: string;
  started_at?: string;
  completed_at?: string;
}

/** ëŒ€ëŸ‰ SMS Job ëª©ë¡ ì‘ë‹µ */
export interface BulkSMSJobListResponse {
  items: BulkSMSJobDetail[];
  total: number;
  page: number;
  page_size: number;
}
```

#### 5.1.2 ìˆ˜ì • íŒŒì¼: `frontend/src/lib/api/admin/sms.ts`

**ì¶”ê°€í•  í•¨ìˆ˜:**

```typescript
import type {
  SMSRecipientsResponse,
  BulkSMSSendRequest,
  BulkSMSJobResponse,
  BulkSMSJobDetail,
  BulkSMSJobListResponse,
} from "./types";

/**
 * SMS ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ
 */
export async function getSMSRecipients(
  token: string,
  params: {
    target_type: "application" | "partner";
    status?: string;
    search?: string;
    page?: number;
    page_size?: number;
  }
): Promise<SMSRecipientsResponse> {
  const searchParams = new URLSearchParams();
  searchParams.set("target_type", params.target_type);
  if (params.status) searchParams.set("status", params.status);
  if (params.search) searchParams.set("search", params.search);
  if (params.page) searchParams.set("page", params.page.toString());
  if (params.page_size) searchParams.set("page_size", params.page_size.toString());

  return fetchWithAuth<SMSRecipientsResponse>(
    `/admin/sms/recipients?${searchParams.toString()}`,
    token
  );
}

/**
 * ëŒ€ëŸ‰ SMS ë°œì†¡ Job ìƒì„±
 */
export async function createBulkSMS(
  token: string,
  data: BulkSMSSendRequest
): Promise<BulkSMSJobResponse> {
  return fetchWithAuth<BulkSMSJobResponse>("/admin/sms/bulk", token, {
    method: "POST",
    body: JSON.stringify(data),
  });
}

/**
 * ëŒ€ëŸ‰ SMS Job ìƒíƒœ ì¡°íšŒ
 */
export async function getBulkSMSJob(
  token: string,
  jobId: number
): Promise<BulkSMSJobDetail> {
  return fetchWithAuth<BulkSMSJobDetail>(`/admin/sms/bulk/${jobId}`, token);
}

/**
 * ëŒ€ëŸ‰ SMS Job ëª©ë¡ ì¡°íšŒ
 */
export async function getBulkSMSJobs(
  token: string,
  params?: { page?: number; page_size?: number }
): Promise<BulkSMSJobListResponse> {
  const searchParams = new URLSearchParams();
  if (params?.page) searchParams.set("page", params.page.toString());
  if (params?.page_size) searchParams.set("page_size", params.page_size.toString());

  const query = searchParams.toString();
  return fetchWithAuth<BulkSMSJobListResponse>(
    `/admin/sms/bulk${query ? `?${query}` : ""}`,
    token
  );
}
```

#### 5.1.3 ì‹ ê·œ ì»´í¬ë„ŒíŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
frontend/src/components/sms/
â”œâ”€â”€ index.ts                    # ëª¨ë“ˆ export
â”œâ”€â”€ BulkSMSSheet.tsx           # ë³µìˆ˜ ë°œì†¡ ë©”ì¸ íŒ¨ë„
â”œâ”€â”€ RecipientSelector.tsx      # ìˆ˜ì‹ ì ì„ íƒ (íƒ­, í•„í„°)
â”œâ”€â”€ RecipientTable.tsx         # ì²´í¬ë°•ìŠ¤ í…Œì´ë¸”
â”œâ”€â”€ MessageComposer.tsx        # ë©”ì‹œì§€ ì‘ì„± ì˜ì—­
â”œâ”€â”€ SMSPreviewDialog.tsx       # ë°œì†¡ ì „ ë¯¸ë¦¬ë³´ê¸°
â”œâ”€â”€ SendProgressDialog.tsx     # ë°œì†¡ ì§„í–‰ ìƒí™©
â””â”€â”€ QuickSMSDialog.tsx         # ê¸°ì¡´ í˜ì´ì§€ í†µí•©ìš© ê°„í¸ ë°œì†¡
```

#### 5.1.4 ì‹ ê·œ íŒŒì¼: `frontend/src/components/sms/BulkSMSSheet.tsx`

**UI êµ¬ì¡°:**

```
+------------------------------------------------------------------+
| ë³µìˆ˜ SMS ë°œì†¡                                              [X]   |
+------------------------------------------------------------------+
|                                                                  |
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        |
| â”‚  ê³ ê°    â”‚ â”‚ í˜‘ë ¥ì‚¬   â”‚                          <- íƒ­         |
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        |
|                                                                  |
+------------------------------------------------------------------+
| í•„í„°:                                                            |
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
| â”‚ ìƒíƒœ ì „ì²´   â–¼ â”‚ â”‚ ì§€ì—­ ì „ì²´   â–¼ â”‚ â”‚ ê²€ìƒ‰...               ğŸ”â”‚  |
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
+------------------------------------------------------------------+
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
| â”‚ [âœ“] ì „ì²´ ì„ íƒ (15ëª…)                       ì„ íƒë¨: 5ëª…     â”‚  |
| â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  |
| â”‚ [ ] í™ê¸¸ë™    010-****-5678    ì–‘í‰êµ°    ì‹ ê·œ              â”‚  |
| â”‚ [âœ“] ê¹€ì² ìˆ˜    010-****-6789    ê°€í‰êµ°    ìƒë‹´ì¤‘            â”‚  |
| â”‚ [âœ“] ì´ì˜í¬    010-****-7890    ì–‘í‰êµ°    ë°°ì •ì™„ë£Œ          â”‚  |
| â”‚ [âœ“] ë°•ë¯¼ìˆ˜    010-****-8901    ê°€í‰êµ°    ì™„ë£Œ              â”‚  |
| â”‚ ...                                                         â”‚  |
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                                                  |
|                     [ì´ì „] [1] [2] [3] [ë‹¤ìŒ]                    |
|                                                                  |
+------------------------------------------------------------------+
| ë©”ì‹œì§€:                                                          |
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
| â”‚ [ì „ë°© í™ˆì¼€ì–´] ì•ˆë…•í•˜ì„¸ìš”.                                   â”‚  |
| â”‚                                                             â”‚  |
| â”‚ ì„œë¹„ìŠ¤ ê´€ë ¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤...                                 â”‚  |
| â”‚                                                             â”‚  |
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
| 125/2000ì (90ì ì´ˆê³¼ ì‹œ LMS)                                    |
|                                                                  |
+------------------------------------------------------------------+
|                                                                  |
|                      [ì·¨ì†Œ]  [ë¯¸ë¦¬ë³´ê¸°]  [ë°œì†¡ (5ê±´)]            |
|                                                                  |
+------------------------------------------------------------------+
```

#### 5.1.5 ì‹ ê·œ íŒŒì¼: `frontend/src/components/sms/SendProgressDialog.tsx`

**UI êµ¬ì¡°:**

```
+------------------------------------------------------------------+
| SMS ë°œì†¡ ì¤‘...                                                   |
+------------------------------------------------------------------+
|                                                                  |
|  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65%                        |
|                                                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚  ì´ ë°œì†¡: 50ëª…                                             â”‚  |
|  â”‚  ì„±ê³µ: 30ê±´  |  ì‹¤íŒ¨: 2ê±´  |  ëŒ€ê¸°: 18ê±´                   â”‚  |
|  â”‚  ì˜ˆìƒ ë‚¨ì€ ì‹œê°„: ì•½ 12ì´ˆ                                   â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                                                  |
|  í˜„ì¬ ë°°ì¹˜: 2 / 3                                                |
|                                                                  |
+------------------------------------------------------------------+
|                                                                  |
|                        [ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜]                        |
|                                                                  |
+------------------------------------------------------------------+
```

**ì™„ë£Œ ì‹œ:**

```
+------------------------------------------------------------------+
| SMS ë°œì†¡ ì™„ë£Œ                                              [X]   |
+------------------------------------------------------------------+
|                                                                  |
|  âœ… ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤                                        |
|                                                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚  ì´ ë°œì†¡: 50ëª…                                             â”‚  |
|  â”‚  ì„±ê³µ: 48ê±´  |  ì‹¤íŒ¨: 2ê±´                                  â”‚  |
|  â”‚  ì†Œìš” ì‹œê°„: 25ì´ˆ                                           â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                                                  |
|  âš ï¸ ì‹¤íŒ¨ ê±´ (2ê±´):                                               |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚  â€¢ í™ê¸¸ë™ (****5678): ìˆ˜ì‹  ê±°ë¶€                            â”‚  |
|  â”‚  â€¢ ê¹€ì² ìˆ˜ (****6789): ë²ˆí˜¸ ì˜¤ë¥˜                            â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                                                  |
+------------------------------------------------------------------+
|                                                                  |
|                              [í™•ì¸]                               |
|                                                                  |
+------------------------------------------------------------------+
```

#### 5.1.6 ì‹ ê·œ íŒŒì¼: `frontend/src/components/common/FloatingActionBar.tsx`

**ì‹ ì²­/í˜‘ë ¥ì‚¬ í˜ì´ì§€ í†µí•©ìš©:**

```
+------------------------------------------------------------------+
|                                                                  |
|  5ê±´ ì„ íƒë¨       [SMS ë°œì†¡]    [ìƒíƒœ ë³€ê²½]    [ì„ íƒ í•´ì œ]       |
|                                                                  |
+------------------------------------------------------------------+
```

#### 5.1.7 ìˆ˜ì • íŒŒì¼: `frontend/src/app/(admin)/admin/sms/page.tsx`

**ë³€ê²½ ì‚¬í•­:**

1. "ë³µìˆ˜ ë°œì†¡" ë²„íŠ¼ ì¶”ê°€
2. BulkSMSSheet ì—°ê²°
3. ë°œì†¡ ë‚´ì—­ì— bulk ë°œì†¡ í‘œì‹œ

```typescript
// ì¶”ê°€í•  ë²„íŠ¼ (ê¸°ì¡´ "SMS ë°œì†¡" ë²„íŠ¼ ì˜†)
<Button onClick={() => setIsBulkSheetOpen(true)}>
  <Users className="h-4 w-4 mr-2" />
  ë³µìˆ˜ ë°œì†¡
</Button>

// Sheet ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
<BulkSMSSheet
  open={isBulkSheetOpen}
  onOpenChange={setIsBulkSheetOpen}
  onSuccess={() => {
    loadStats();
    loadLogs();
  }}
/>
```

#### 5.1.8 ìˆ˜ì • íŒŒì¼: `frontend/src/app/(admin)/admin/applications/page.tsx`

**ë³€ê²½ ì‚¬í•­:**

1. í…Œì´ë¸” ì²« ì»¬ëŸ¼ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
2. ì„ íƒ ìƒíƒœ ê´€ë¦¬
3. FloatingActionBar ì¶”ê°€
4. QuickSMSDialog ì—°ê²°

```typescript
// ìƒíƒœ ì¶”ê°€
const [selectedIds, setSelectedIds] = useState<number[]>([]);
const [isQuickSMSOpen, setIsQuickSMSOpen] = useState(false);

// í…Œì´ë¸” í—¤ë”ì— ì²´í¬ë°•ìŠ¤
<TableHead className="w-12">
  <Checkbox
    checked={selectedIds.length === items.length}
    onCheckedChange={handleSelectAll}
  />
</TableHead>

// í…Œì´ë¸” í–‰ì— ì²´í¬ë°•ìŠ¤
<TableCell>
  <Checkbox
    checked={selectedIds.includes(item.id)}
    onCheckedChange={() => handleSelect(item.id)}
  />
</TableCell>

// FloatingActionBar (ì„ íƒ ì‹œ í‘œì‹œ)
{selectedIds.length > 0 && (
  <FloatingActionBar
    count={selectedIds.length}
    onSMS={() => setIsQuickSMSOpen(true)}
    onClear={() => setSelectedIds([])}
  />
)}

// QuickSMSDialog
<QuickSMSDialog
  open={isQuickSMSOpen}
  onOpenChange={setIsQuickSMSOpen}
  targetType="customer"
  targetIds={selectedIds}
  onSuccess={() => setSelectedIds([])}
/>
```

#### 5.1.9 ìˆ˜ì • íŒŒì¼: `frontend/src/app/(admin)/admin/partners/page.tsx`

**ë³€ê²½ ì‚¬í•­:** ì‹ ì²­ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´ ì ìš©

---

## 6. êµ¬í˜„ ìˆœì„œ ë° ì˜ˆìƒ ê¸°ê°„

### 6.1 Phaseë³„ ì‘ì—…

| Phase | ì‘ì—… | ì˜ˆìƒ ê¸°ê°„ | ì„ í–‰ ì¡°ê±´ |
|-------|------|-----------|-----------|
| **Phase 1** | Backend ëª¨ë¸ ë° ì„œë¹„ìŠ¤ | 1-2ì¼ | - |
| 1-1 | BulkSMSJob ëª¨ë¸ ìƒì„± | 2ì‹œê°„ | - |
| 1-2 | SMSLog ëª¨ë¸ ìˆ˜ì • | 30ë¶„ | 1-1 |
| 1-3 | DB ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš© | 30ë¶„ | 1-2 |
| 1-4 | bulk_sms ìŠ¤í‚¤ë§ˆ ì •ì˜ | 1ì‹œê°„ | - |
| 1-5 | BulkSMSService êµ¬í˜„ | 4ì‹œê°„ | 1-3 |
| 1-6 | sms.py ìˆ˜ì • (bulk íŒŒë¼ë¯¸í„° ì¶”ê°€) | 30ë¶„ | 1-5 |
| **Phase 2** | Backend API | 1ì¼ | Phase 1 |
| 2-1 | /recipients ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ | 2ì‹œê°„ | - |
| 2-2 | /bulk ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ | 2ì‹œê°„ | 1-5 |
| 2-3 | /bulk/{job_id} ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ | 1ì‹œê°„ | 2-2 |
| 2-4 | /bulk ëª©ë¡ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ | 1ì‹œê°„ | 2-2 |
| **Phase 3** | Frontend SMS ë³µìˆ˜ ë°œì†¡ UI | 1-2ì¼ | Phase 2 |
| 3-1 | API íƒ€ì… ë° í•¨ìˆ˜ ì¶”ê°€ | 1ì‹œê°„ | - |
| 3-2 | RecipientTable ì»´í¬ë„ŒíŠ¸ | 2ì‹œê°„ | 3-1 |
| 3-3 | RecipientSelector ì»´í¬ë„ŒíŠ¸ | 2ì‹œê°„ | 3-2 |
| 3-4 | MessageComposer ì»´í¬ë„ŒíŠ¸ | 1ì‹œê°„ | - |
| 3-5 | BulkSMSSheet ì»´í¬ë„ŒíŠ¸ | 3ì‹œê°„ | 3-2, 3-3, 3-4 |
| 3-6 | SMSPreviewDialog ì»´í¬ë„ŒíŠ¸ | 1ì‹œê°„ | 3-5 |
| 3-7 | SendProgressDialog ì»´í¬ë„ŒíŠ¸ | 2ì‹œê°„ | 3-1 |
| 3-8 | SMS í˜ì´ì§€ ìˆ˜ì • | 1ì‹œê°„ | 3-5, 3-7 |
| **Phase 4** | Frontend ê¸°ì¡´ í˜ì´ì§€ í†µí•© | 1ì¼ | Phase 3 |
| 4-1 | FloatingActionBar ì»´í¬ë„ŒíŠ¸ | 1ì‹œê°„ | - |
| 4-2 | QuickSMSDialog ì»´í¬ë„ŒíŠ¸ | 2ì‹œê°„ | 3-5 |
| 4-3 | ì‹ ì²­ ê´€ë¦¬ í˜ì´ì§€ ìˆ˜ì • | 2ì‹œê°„ | 4-1, 4-2 |
| 4-4 | í˜‘ë ¥ì‚¬ ê´€ë¦¬ í˜ì´ì§€ ìˆ˜ì • | 1ì‹œê°„ | 4-3 |
| **Phase 5** | í…ŒìŠ¤íŠ¸ ë° ë§ˆë¬´ë¦¬ | 0.5ì¼ | Phase 4 |
| 5-1 | í†µí•© í…ŒìŠ¤íŠ¸ | 2ì‹œê°„ | - |
| 5-2 | ë²„ê·¸ ìˆ˜ì • | 2ì‹œê°„ | 5-1 |

### 6.2 ì „ì²´ ì˜ˆìƒ ê¸°ê°„

| êµ¬ë¶„ | ê¸°ê°„ |
|------|------|
| ìµœì†Œ | 4.5ì¼ |
| ìµœëŒ€ | 6.5ì¼ |
| **ê¶Œì¥** | **5ì¼** |

---

## 7. ì œì•½ì‚¬í•­ ë° ê³ ë ¤ì‚¬í•­

### 7.1 ê¸°ìˆ ì  ì œì•½

| ì œì•½ì‚¬í•­ | ì˜í–¥ | ëŒ€ì‘ ë°©ì•ˆ |
|----------|------|-----------|
| Aligo API Rate Limit | ê³¼ë„í•œ ìš”ì²­ ì‹œ ì°¨ë‹¨ ê°€ëŠ¥ | ë°°ì¹˜ ê°„ 0.5ì´ˆ ë”œë ˆì´ |
| HTTP íƒ€ì„ì•„ì›ƒ | ëŒ€ê·œëª¨ ë™ê¸° ë°œì†¡ ë¶ˆê°€ | ë¹„ë™ê¸° Job ì²˜ë¦¬ |
| ì„œë²„ ì¬ì‹œì‘ | ì²˜ë¦¬ ì¤‘ Job ì¤‘ë‹¨ | status ê¸°ë°˜ ë³µêµ¬ (í–¥í›„) |
| DB ì„¸ì…˜ ê´€ë¦¬ | ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ ì„¸ì…˜ | ë³„ë„ ì„¸ì…˜ ìƒì„± |

### 7.2 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ëŒ€ì‘ |
|------|------|
| ì „í™”ë²ˆí˜¸ ë…¸ì¶œ | ëª©ë¡ì—ì„œ ë§ˆìŠ¤í‚¹ (010-****-5678) |
| ê¶Œí•œ ê²€ì¦ | ëª¨ë“  APIì— ê´€ë¦¬ì ì¸ì¦ í•„ìˆ˜ |
| ë°œì†¡ ê¸°ë¡ | SMSLogì— ëª¨ë“  ë°œì†¡ ê¸°ë¡ |

### 7.3 ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ìˆ˜ì¹˜ | ë¹„ê³  |
|------|------|------|
| ë°°ì¹˜ í¬ê¸° | 50ëª… | API ì•ˆì •ì„± ê³ ë ¤ |
| ë°°ì¹˜ ë‚´ ë³‘ë ¬ ì²˜ë¦¬ | O | asyncio.gather ì‚¬ìš© |
| ë°°ì¹˜ ê°„ ë”œë ˆì´ | 0.5ì´ˆ | Rate Limit ë°©ì§€ |
| ì¬ì‹œë„ íšŸìˆ˜ | 3íšŒ | ì§€ìˆ˜ ë°±ì˜¤í”„ |
| í´ë§ ê°„ê²© | 3ì´ˆ | ì§„í–‰ ìƒí™© ì¡°íšŒ |

### 7.4 í–¥í›„ í™•ì¥ ê³ ë ¤

| ê¸°ëŠ¥ | ìš°ì„ ìˆœìœ„ | ë¹„ê³  |
|------|----------|------|
| SMS í…œí”Œë¦¿ ê´€ë¦¬ | ì¤‘ | ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ ì €ì¥ |
| ì˜ˆì•½ ë°œì†¡ | ì¤‘ | íŠ¹ì • ì‹œê°„ì— ë°œì†¡ |
| ë³€ìˆ˜ ì¹˜í™˜ | í•˜ | {ê³ ê°ëª…}, {ì„œë¹„ìŠ¤ëª…} ë“± |
| ë°œì†¡ í†µê³„ ëŒ€ì‹œë³´ë“œ | í•˜ | ì¼ë³„/ì›”ë³„ í†µê³„ |

---

## 8. ë¶€ë¡

### 8.1 API ëª…ì„¸ ìš”ì•½

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/admin/sms/recipients` | ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ |
| POST | `/admin/sms/bulk` | ë³µìˆ˜ ë°œì†¡ Job ìƒì„± |
| GET | `/admin/sms/bulk/{job_id}` | Job ìƒíƒœ ì¡°íšŒ |
| GET | `/admin/sms/bulk` | Job ëª©ë¡ ì¡°íšŒ |

### 8.2 ìƒíƒœ íë¦„ë„

```
BulkSMSJob ìƒíƒœ:

pending â”€â”€â”€â”€â”€â”€â–º processing â”€â”€â”€â”€â”€â”€â–º completed
                    â”‚
                    â”‚              partial_failed
                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º failed

                cancelled (ê´€ë¦¬ì ì·¨ì†Œ)
```

### 8.3 ì°¸ê³  ë¬¸ì„œ

- [ì•Œë¦¬ê³  SMS API ë¬¸ì„œ](https://smartsms.aligo.in/smsapi.html)
- í”„ë¡œì íŠ¸ CLAUDE.md
- docs/API_SPEC.md
- docs/DATABASE.md
